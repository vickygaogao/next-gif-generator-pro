version: 1
frontend:
  phases:
    preBuild:
      commands:
        - rm -rf node_modules # 删除 node_modules
        - npm install # 安装依赖
    build:
      commands:
        - rm -rf .next
        - npm run build
        - rm -rf .next/cache
        - rm -rf .next/standalone
        - du -sh .next # 查看总大小
        - ls -la .next/
        - du -h .next/* | sort -h # 查看每个文件的大小
        - npm list --depth=0 # 查看安装的依赖
  artifacts:
    baseDirectory: .next
    files:
      - static/**/*
      - server/**/*.json
      - build-manifest.json
      - react-loadable-manifest.json
      - routes-manifest.json
      - required-server-files.json
      - package.json
    exclude:
      - cache/**/*
      - server/pages/api/**
      - server/chunks/**
      - standalone/**/* # 排除 standalone 目录
  cache:
    paths:
      - node_modules/**/*
